<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="theme-color" content="#0e5e55">
  <title>Diagnos - Mobile App</title>

  <!-- Manifest -->
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" sizes="192x192" href="./icons/icon-192.png">

  <!-- Bootstrap & jQuery (CDN) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    body{background:#e6f3ee;color:#0e2a26}
    .app {max-width:420px;margin:auto;min-height:100dvh;display:flex;flex-direction:column}
    .card-soft{background:#cfe7df;border:none;border-radius:14px}
    .nav-bottom{position:sticky;bottom:0;z-index:10}
  </style>
</head>
<body>
<div class="app">
  <!-- Header -->
  <header class="p-3">
    <div class="d-flex align-items-center gap-2">
      <div class="rounded-circle bg-success text-white fw-bold d-grid place-items-center" style="width:32px;height:32px;display:grid">D</div>
      <div>
        <div class="small text-muted">Halo, <span id="userName">Augustusalexander</span></div>
        <div class="small">Rekomendasi Sehat Anda</div>
      </div>
      <button id="installBtn" class="btn btn-success btn-sm ms-auto d-none">Pasang App</button>
    </div>
  </header>

  <!-- View -->
  <main id="view" class="flex-grow-1 px-3 pb-3"></main>

  <!-- Bottom Nav -->
  <nav class="navbar navbar-dark bg-success nav-bottom">
    <div class="container-fluid justify-content-around">
      <a class="nav-link text-white small" href="#/home">üè†<br>Home</a>
      <a class="nav-link text-white small" href="#/riwayat">üóÇÔ∏è<br>Riwayat</a>
      <a class="nav-link text-white small" href="#/layanan">üß™<br>Layanan</a>
      <a class="nav-link text-white small" href="#/akun">üë§<br>Akun</a>
    </div>
  </nav>
</div>

<script>
  // --- Mini Router jQuery (hash-based) ---
  const state = {
    userName: localStorage.getItem('userName') || 'Augustusalexander',
    notif: JSON.parse(localStorage.getItem('notif') || 'false')
  };

  const pages = {
    home: () => (`
      <section class="mb-3">
        ${recCard('MEDICAL CHECK UP SILVER',['Profil darah, gula, kolesterol, Asam Urat'], 980000, 393000)}
        ${recCard('MEDICAL CHECK UP PLATINUM',['Profil darah, gula, kolesterol, fungsi organ'], 1290000, 460000)}
        <div class="text-end small text-muted">... lainnya &raquo;</div>
      </section>

      <section class="mb-3">
        <h6 class="fw-bold mb-2">Aksi Sehat</h6>
        <div class="row g-2">
          ${tile('Jadwal','üóìÔ∏è','#/layanan')}
          ${tile('Hasil','üìÑ','#/riwayat')}
          ${tile('Home Care','üè•','#/layanan')}
          ${tile('Cara Program','‚ÑπÔ∏è','#/layanan')}
        </div>
      </section>

      <section>
        <h6 class="fw-bold mb-2">Tips Kesehatan</h6>
        <div class="card card-soft p-3">
          <strong>DIET TEPAT USIA EMAS</strong>
          <div class="small text-muted">Program asupan usia matang.</div>
        </div>
      </section>
    `),

    riwayat: () => (`
      <h6 class="fw-bold mb-2">Riwayat Pemeriksaan</h6>
      <div class="card card-soft p-3 mb-2">
        <div class="fw-semibold">MCU Silver - 02 Agu 2025</div>
        <div class="small text-muted mb-2">Ringkasan: Normal, cek ulang 6 bulan.</div>
        <button class="btn btn-success btn-sm" data-action="lihat-hasil">Lihat Hasil</button>
      </div>
      <div class="small text-muted">Belum ada data lain.</div>
    `),

    layanan: () => (`
      <h6 class="fw-bold mb-2">Layanan</h6>
      <div class="card card-soft p-3 mb-2">
        <div class="fw-semibold">Booking Jadwal</div>
        <div class="small text-muted mb-2">Pilih cabang & tanggal.</div>
        <button class="btn btn-success btn-sm" data-action="booking">Mulai</button>
      </div>
      <div class="card card-soft p-3">
        <div class="fw-semibold">Home Care</div>
        <div class="small text-muted mb-2">Kunjungan petugas ke lokasi Anda.</div>
        <button class="btn btn-success btn-sm" data-action="homecare">Ajukan</button>
      </div>
    `),

    akun: () => (`
      <h6 class="fw-bold mb-2">Akun</h6>
      <div class="card card-soft p-3 mb-2">
        <div class="mb-2">Nama: <strong>${state.userName}</strong></div>
        <button class="btn btn-outline-success btn-sm" data-action="ubah-nama">Ubah Nama</button>
      </div>
      <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" id="notif" ${state.notif?'checked':''}>
        <label class="form-check-label small" for="notif">Aktifkan notifikasi</label>
      </div>
      <button class="btn btn-danger btn-sm" data-action="logout">Keluar</button>
    `)
  };

  function recCard(title, bullets, before, after){
    const fmt = (n)=> new Intl.NumberFormat('id-ID').format(n);
    return `
      <div class="card card-soft p-3 mb-2">
        <div class="badge text-bg-light text-success mb-1">PROMOCARE</div>
        <div class="fw-semibold">${title}</div>
        <ul class="small text-muted mb-2">${bullets.map(b=>`<li>${b}</li>`).join('')}</ul>
        <div class="d-flex align-items-center gap-2">
          <span class="text-decoration-line-through small text-muted">Rp ${fmt(before)}</span>
          <strong>Rp ${fmt(after)}</strong>
          <button class="btn btn-success btn-sm ms-auto" data-action="order">Ambil</button>
        </div>
      </div>`;
  }
  function tile(label,emoji,href){
    return `<div class="col-3"><a class="btn btn-light w-100 py-3" href="${href}" aria-label="${label}">${emoji}<br><span class="small">${label}</span></a></div>`;
  }

  function render(){
    $('#userName').text(state.userName);
    const hash = (location.hash.replace('#/','') || 'home');
    const html = (pages[hash] || pages.home)();
    $('#view').html(html);

    // bind actions
    $('[data-action="ubah-nama"]').on('click', ()=>{
      const name = prompt('Nama Anda?', state.userName);
      if(name){ state.userName = name; localStorage.setItem('userName',name); render(); }
    });
    $('#notif').on('change', function(){
      state.notif = $(this).is(':checked');
      localStorage.setItem('notif', JSON.stringify(state.notif));
    });
    $('[data-action="logout"]').on('click', ()=>{ if(confirm('Keluar?')){ localStorage.clear(); location.reload(); } });
    $('[data-action="order"]').on('click', ()=> alert('Order dimulai (mock)...'));
    $('[data-action="booking"]').on('click', ()=> alert('Booking jadwal (mock)...'));
    $('[data-action="homecare"]').on('click', ()=> alert('Ajukan Home Care (mock)...'));
    $('[data-action="lihat-hasil"]').on('click', ()=> alert('Menampilkan hasil (mock)...'));
  }

  $(window).on('hashchange', render);
  $(render);

  // --- PWA: register SW + install prompt ---
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
  }
  let deferredPrompt; const installBtn = $('#installBtn');
  window.addEventListener('beforeinstallprompt', (e)=>{
    e.preventDefault(); deferredPrompt = e; installBtn.removeClass('d-none');
  });
  installBtn.on('click', async ()=>{
    if(!deferredPrompt) return;
    deferredPrompt.prompt();
    await deferredPrompt.userChoice;
    deferredPrompt = null;
    installBtn.addClass('d-none');
  });
</script>
</body>
</html>
